"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var sqlite = require("nativescript-sqlite");
var visit_1 = require("./visit");
var VisitDatabaseService = (function () {
    function VisitDatabaseService() {
        console.log("In Visit DB Service Constructor");
    }
    // create a table
    VisitDatabaseService.prototype.createTable = function () {
        new sqlite("visit.db", function (err, db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS Visit (id INTEGER PRIMARY KEY, customer_id TEXT, beacon TEXT, start DATETIME,end DATETIME,creating NUMERIC, active NUMERIC, keywords JSON )", [], function (err) {
                console.log("TABLE Visit CREATED");
                return true;
            });
        });
    };
    // drops a table
    VisitDatabaseService.prototype.dropTable = function () {
        new sqlite("visit.db", function (err, db) {
            db.execSQL("DROP TABLE IF EXISTS Visit", [], function (err) {
                console.log("TABLE Visit DROPPED");
                return true;
            });
        });
    };
    VisitDatabaseService.prototype.insertVisit = function (visit) {
        console.log("Attempting to insert: " + visit.id);
        new sqlite("visit.db", function (err, db) {
            db.execSQL("INSERT INTO Visit (id,customer_id,  beacon , start ,end ,creating , active , keywords ) VALUES (?,?,?,?,?,?,?,?)", [visit.id, visit.customer_id, visit.beacon, visit.start, visit.end, visit.creating, visit.active, visit.keywords], function (err, id) {
                console.log("The new record with id " + id + " and beacon " + visit.beacon);
                return true;
            });
        });
    };
    // update an existing record
    VisitDatabaseService.prototype.updateVisit = function (id, customer_id, beacon, start, end, creating, active, keywords) {
        new sqlite("visit.db", function (err, db) {
            db.execSQL("UPDATE Visit SET customer_id = ?, beacon = ?, start = ?, end = ?, creating = ?, active = ?, keywords = ? WHERE id = ?", [customer_id, beacon, start, end, creating, active, keywords, id], function (err, id) {
                console.log("The existing record id is: " + id);
                return true;
            });
        });
    };
    // delete a record
    VisitDatabaseService.prototype.deleteVisit = function (id) {
        console.log("About to delete visit from db: " + id);
        new sqlite("visit.db", function (err, db) {
            db.execSQL("DELETE FROM Visit WHERE id = ?", [id], function (err, id) {
                console.log("The deleted record id is: " + id);
                return true;
            });
        });
    };
    // select a single record
    VisitDatabaseService.prototype.selectVisit = function (id) {
        var record;
        new sqlite("visit.db", function (err, db) {
            db.get("SELECT * FROM Visit WHERE id = ?", [id], function (err, row) {
                // console.log("Row of data was: " + row);  // Prints [["Field1", "Field2",...]] 
                // console.log("1: "+row[1]);
                record = row;
                // return row;
            });
        });
        return record;
    };
    // select a single record
    VisitDatabaseService.prototype.selectVisitByBeacon = function (beacon) {
        console.log("select beacon: " + beacon);
        var record;
        new sqlite("visit.db", function (err, db) {
            db.get("SELECT * FROM Visit WHERE beacon = ?", [beacon], function (err, row) {
                // console.log("Row of data was: " + row);  // Prints [["Field1", "Field2",...]] 
                // console.log("1: "+row[1]);
                record = row;
                // return row;
            });
        });
        console.log("record (visit):" + record);
        return record;
    };
    // select all records
    VisitDatabaseService.prototype.selectVisits = function () {
        var visits = new Array();
        new sqlite("visit.db", function (err, db) {
            db.all("SELECT * FROM Visit ORDER BY id", [], function (err, rs) {
                rs.forEach(function (element) {
                    // console.log("E0: "+element[0]);
                    // console.log("E1: "+element[1]);
                    // console.log("E2: "+element[2]);
                    // console.log("E3: "+element[3]);
                    // console.log("E4: "+element[4]);
                    // console.log("E5: "+element[5]);
                    // console.log("E6: "+element[6]);
                    // console.log("E7: "+element[7]);
                    var visitObj = new visit_1.Visit(element[1], element[2], element[3], element[4]);
                    visitObj.id = element[0];
                    visitObj.creating = element[5];
                    visitObj.active = element[6];
                    visitObj.keywords = element[7];
                    visits.push(visitObj);
                });
            });
        });
        return visits;
    };
    VisitDatabaseService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], VisitDatabaseService);
    return VisitDatabaseService;
}());
exports.VisitDatabaseService = VisitDatabaseService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzaXQuZGIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZpc2l0LmRiLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBeUQ7QUFDekQsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFFLHFCQUFxQixDQUFFLENBQUM7QUFDaEQsaUNBQWdDO0FBR2hDO0lBRUU7UUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELGlCQUFpQjtJQUNqQiwwQ0FBVyxHQUFYO1FBQ0UsSUFBSSxNQUFNLENBQUMsVUFBVSxFQUFFLFVBQVMsR0FBRyxFQUFFLEVBQUU7WUFDbkMsRUFBRSxDQUFDLE9BQU8sQ0FBQyx3S0FBd0ssRUFBRSxFQUFFLEVBQUUsVUFBUyxHQUFHO2dCQUNqTSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7Z0JBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDaEIsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxnQkFBZ0I7SUFDaEIsd0NBQVMsR0FBVDtRQUNFLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRSxVQUFTLEdBQUcsRUFBRSxFQUFFO1lBQ25DLEVBQUUsQ0FBQyxPQUFPLENBQUMsNEJBQTRCLEVBQUUsRUFBRSxFQUFFLFVBQVMsR0FBRztnQkFDckQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsMENBQVcsR0FBWCxVQUFZLEtBQVk7UUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsR0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0MsSUFBSSxNQUFNLENBQUMsVUFBVSxFQUFFLFVBQVMsR0FB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QixDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFoSFUsb0JBQW9CO1FBRGhDLGlCQUFVLEVBQUU7O09BQ0Esb0JBQW9CLENBZ0poQztJQUFELDJCQUFDO0NBQUEsQUFoSkQsSUFnSkM7QUFoSlksb0RBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgRXZlbnRFbWl0dGVyIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmNvbnN0IHNxbGl0ZSA9IHJlcXVpcmUoIFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiICk7XG5pbXBvcnQgeyBWaXNpdCB9IGZyb20gXCIuL3Zpc2l0XCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBWaXNpdERhdGFiYXNlU2VydmljZSB7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgICAgY29uc29sZS5sb2coXCJJbiBWaXNpdCBEQiBTZXJ2aWNlIENvbnN0cnVjdG9yXCIpO1xuICB9XG5cbiAgLy8gY3JlYXRlIGEgdGFibGVcbiAgY3JlYXRlVGFibGUoKSB7XG4gICAgbmV3IHNxbGl0ZShcInZpc2l0LmRiXCIsIGZ1bmN0aW9uKGVyciwgZGIpIHtcbiAgICAgICAgZGIuZXhlY1NRTChcIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIFZpc2l0IChpZCBJTlRFR0VSIFBSSU1BUlkgS0VZLCBjdXN0b21lcl9pZCBURVhULCBiZWFjb24gVEVYVCwgc3RhcnQgREFURVRJTUUsZW5kIERBVEVUSU1FLGNyZWF0aW5nIE5VTUVSSUMsIGFjdGl2ZSBOVU1FUklDLCBrZXl3b3JkcyBKU09OIClcIiwgW10sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUQUJMRSBWaXNpdCBDUkVBVEVEXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyBkcm9wcyBhIHRhYmxlXG4gIGRyb3BUYWJsZSgpIHtcbiAgICBuZXcgc3FsaXRlKFwidmlzaXQuZGJcIiwgZnVuY3Rpb24oZXJyLCBkYikge1xuICAgICAgICBkYi5leGVjU1FMKFwiRFJPUCBUQUJMRSBJRiBFWElTVFMgVmlzaXRcIiwgW10sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUQUJMRSBWaXNpdCBEUk9QUEVEXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIFxuICBpbnNlcnRWaXNpdCh2aXNpdDogVmlzaXQpIHtcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgdG8gaW5zZXJ0OiBcIit2aXNpdC5pZCk7XG4gICAgbmV3IHNxbGl0ZShcInZpc2l0LmRiXCIsIGZ1bmN0aW9uKGVyciwgZGIpIHtcbiAgICAgICAgZGIuZXhlY1NRTChcIklOU0VSVCBJTlRPIFZpc2l0IChpZCxjdXN0b21lcl9pZCwgIGJlYWNvbiAsIHN0YXJ0ICxlbmQgLGNyZWF0aW5nICwgYWN0aXZlICwga2V5d29yZHMgKSBWQUxVRVMgKD8sPyw/LD8sPyw/LD8sPylcIiwgW3Zpc2l0LmlkLHZpc2l0LmN1c3RvbWVyX2lkLCB2aXNpdC5iZWFjb24sIHZpc2l0LnN0YXJ0LCB2aXNpdC5lbmQsIHZpc2l0LmNyZWF0aW5nLCB2aXNpdC5hY3RpdmUsIHZpc2l0LmtleXdvcmRzXSwgZnVuY3Rpb24oZXJyLCBpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgbmV3IHJlY29yZCB3aXRoIGlkIFwiICsgaWQrXCIgYW5kIGJlYWNvbiBcIit2aXNpdC5iZWFjb24pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyB1cGRhdGUgYW4gZXhpc3RpbmcgcmVjb3JkXG4gIHVwZGF0ZVZpc2l0KGlkLGN1c3RvbWVyX2lkLCAgYmVhY29uICwgc3RhcnQgLGVuZCAsY3JlYXRpbmcgLCBhY3RpdmUgLCBrZXl3b3Jkcykge1xuICAgIG5ldyBzcWxpdGUoXCJ2aXNpdC5kYlwiLCBmdW5jdGlvbihlcnIsIGRiKSB7XG4gICAgICAgIGRiLmV4ZWNTUUwoXCJVUERBVEUgVmlzaXQgU0VUIGN1c3RvbWVyX2lkID0gPywgYmVhY29uID0gPywgc3RhcnQgPSA/LCBlbmQgPSA/LCBjcmVhdGluZyA9ID8sIGFjdGl2ZSA9ID8sIGtleXdvcmRzID0gPyBXSEVSRSBpZCA9ID9cIiwgW2N1c3RvbWVyX2lkLCBiZWFjb24sIHN0YXJ0LCBlbmQsIGNyZWF0aW5nLCBhY3RpdmUsIGtleXdvcmRzLCBpZF0sIGZ1bmN0aW9uKGVyciwgaWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIGV4aXN0aW5nIHJlY29yZCBpZCBpczogXCIgKyBpZCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIGRlbGV0ZSBhIHJlY29yZFxuICBkZWxldGVWaXNpdChpZCkge1xuICAgICAgY29uc29sZS5sb2coXCJBYm91dCB0byBkZWxldGUgdmlzaXQgZnJvbSBkYjogXCIraWQpXG4gICAgbmV3IHNxbGl0ZShcInZpc2l0LmRiXCIsIGZ1bmN0aW9uKGVyciwgZGIpIHtcbiAgICAgICAgZGIuZXhlY1NRTChcIkRFTEVURSBGUk9NIFZpc2l0IFdIRVJFIGlkID0gP1wiLCBbaWRdLCBmdW5jdGlvbihlcnIsIGlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBkZWxldGVkIHJlY29yZCBpZCBpczogXCIgKyBpZCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIHNlbGVjdCBhIHNpbmdsZSByZWNvcmRcbiAgc2VsZWN0VmlzaXQoaWQpOiBWaXNpdCB7XG4gICAgbGV0IHJlY29yZDogVmlzaXQ7XG4gICAgbmV3IHNxbGl0ZShcInZpc2l0LmRiXCIsIGZ1bmN0aW9uKGVyciwgZGIpIHtcbiAgICAgICAgZGIuZ2V0KFwiU0VMRUNUICogRlJPTSBWaXNpdCBXSEVSRSBpZCA9ID9cIiwgW2lkXSwgZnVuY3Rpb24oZXJyLCByb3cpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUm93IG9mIGRhdGEgd2FzOiBcIiArIHJvdyk7ICAvLyBQcmludHMgW1tcIkZpZWxkMVwiLCBcIkZpZWxkMlwiLC4uLl1dIFxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCIxOiBcIityb3dbMV0pO1xuICAgICAgICAgICAgcmVjb3JkID0gcm93O1xuICAgICAgICAgICAgLy8gcmV0dXJuIHJvdztcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlY29yZDtcbiAgfVxuXG4gICAgLy8gc2VsZWN0IGEgc2luZ2xlIHJlY29yZFxuICAgIHNlbGVjdFZpc2l0QnlCZWFjb24oYmVhY29uKTogVmlzaXQge1xuICAgICAgICBjb25zb2xlLmxvZyhcInNlbGVjdCBiZWFjb246IFwiK2JlYWNvbik7XG4gICAgICAgIGxldCByZWNvcmQ6IFZpc2l0O1xuICAgICAgICBuZXcgc3FsaXRlKFwidmlzaXQuZGJcIiwgZnVuY3Rpb24oZXJyLCBkYikge1xuICAgICAgICAgICAgZGIuZ2V0KFwiU0VMRUNUICogRlJPTSBWaXNpdCBXSEVSRSBiZWFjb24gPSA/XCIsIFtiZWFjb25dLCBmdW5jdGlvbihlcnIsIHJvdykge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUm93IG9mIGRhdGEgd2FzOiBcIiArIHJvdyk7ICAvLyBQcmludHMgW1tcIkZpZWxkMVwiLCBcIkZpZWxkMlwiLC4uLl1dIFxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiMTogXCIrcm93WzFdKTtcbiAgICAgICAgICAgICAgICByZWNvcmQgPSByb3c7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHJvdztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZWNvcmQgKHZpc2l0KTpcIiArcmVjb3JkKTtcbiAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgIH1cbiAgXG4gIC8vIHNlbGVjdCBhbGwgcmVjb3Jkc1xuICBzZWxlY3RWaXNpdHMoKTogQXJyYXk8VmlzaXQ+IHtcbiAgICBsZXQgdmlzaXRzID0gbmV3IEFycmF5PFZpc2l0PigpO1xuICAgIG5ldyBzcWxpdGUoXCJ2aXNpdC5kYlwiLCBmdW5jdGlvbihlcnIsIGRiKSB7XG4gICAgICAgIGRiLmFsbChcIlNFTEVDVCAqIEZST00gVmlzaXQgT1JERVIgQlkgaWRcIiwgW10sIGZ1bmN0aW9uKGVyciwgcnMpIHtcbiAgICAgICAgICBycy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJFMDogXCIrZWxlbWVudFswXSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkUxOiBcIitlbGVtZW50WzFdKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiRTI6IFwiK2VsZW1lbnRbMl0pO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJFMzogXCIrZWxlbWVudFszXSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkU0OiBcIitlbGVtZW50WzRdKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiRTU6IFwiK2VsZW1lbnRbNV0pO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJFNjogXCIrZWxlbWVudFs2XSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkU3OiBcIitlbGVtZW50WzddKTtcbiAgICAgICAgICAgIGxldCB2aXNpdE9iaiA9IG5ldyBWaXNpdChlbGVtZW50WzFdLCBlbGVtZW50WzJdLCBlbGVtZW50WzNdLCBlbGVtZW50WzRdKTtcbiAgICAgICAgICAgIHZpc2l0T2JqLmlkID0gZWxlbWVudFswXTtcbiAgICAgICAgICAgIHZpc2l0T2JqLmNyZWF0aW5nID0gZWxlbWVudFs1XTtcbiAgICAgICAgICAgIHZpc2l0T2JqLmFjdGl2ZSA9IGVsZW1lbnRbNl07XG4gICAgICAgICAgICB2aXNpdE9iai5rZXl3b3JkcyA9IGVsZW1lbnRbN107XG4gICAgICAgICAgICB2aXNpdHMucHVzaCh2aXNpdE9iaik7XG4gICAgICAgICAgICBcbiAgICAgICAgICB9KTsgICBcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHZpc2l0cztcbiAgfSAgIFxuXG4vLyAgIGZpbmlzaFZpc2l0cygpe1xuLy8gICAgIGxldCByZXBseSA9IGZhbHNlXG4vLyAgICAgICAvLyBSZXRyaXZlIGFsbCB2aXNpdHMgKHNob3VsZCBiZSBtYXggMSlcbi8vICAgICAgIGxldCB2aXNpdHMgPSB0aGlzLnNlbGVjdFZpc2l0cygpO1xuXG4vLyAgICAgICBjb25zb2xlLmxvZyhcImhvdyBtYW55IGludGVyc3RzIHRvIGZpbmlzaDogXCIrdmlzaXRzLmxlbmd0aCk7XG4vLyAgICAgICAvLyBpZiB0aGVyZSBpcyBhbiB2aXNpdCBcbi8vICAgICAgIGlmICh2aXNpdHMubGVuZ3RoID4gMCl7XG4vLyAgICAgICAgICAgdmlzaXRzLmZvckVhY2godmlzaXQgPT57XG4vLyAgICAgICAgICAgbGV0IHN0YXJ0ID0gbmV3IERhdGUodmlzaXRbM10pO1xuLy8gICAgICAgICAgIGxldCBlbmQgPSBuZXcgRGF0ZSh2aXNpdFs0XSk7XG4vLyAgICAgICAgICAgbGV0IGR1cmF0aW9uID0gZW5kLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKTtcbi8vICAgICAgICAgICBsZXQgc2luY2VMYXN0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBlbmQuZ2V0VGltZSgpO1xuLy8gICAgICAgICAgIC8vIGlmIHNpbmNlTGFzdCA+IDYwIHNlY29uZHMgPC0gdGhpcyBpcyBjcnVjaWFsIGZvciBrbm93aW5nIGlmIGl0IGlzIGF3YXlcbi8vICAgICAgICAgICBpZihzaW5jZUxhc3QgPiA2MDAwMCl7XG4vLyAgICAgICAgICAgICAgIC8vIGlmIGR1cmF0aW9uICA+IDEgbWludXRlIHRoZW4gc2VuZCB2aXNpdFxuLy8gICAgICAgICAgICAgICBpZiggZHVyYXRpb24gPiA2MDAwMCl7XG4vLyAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbmRpbmcgdmlzaXQgYjogXCIrdmlzaXRbMF0pXG4vLyAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFjdHVhbCBpbXBsZW1lbnRhdGlvbiBwZW5kaW5nLi5cIik7XG4vLyAgICAgICAgICAgICAgICAgICByZXBseSA9IHRydWVcbi8vICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlbGV0aW5nIHZpc2l0IGR1ZSB0byBtb3JlIHRoYW4gMSBtaW51dGUgYXdheTogXCIrdmlzaXRbMF0pO1xuLy8gICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVZpc2l0KHZpc2l0WzBdKTtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgfSk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIHJldHVybiByZXBseTtcbi8vIH1cblxufSJdfQ==